# RMVPE

**Ссылка на `HPA_RMVPE` модель**: [HPA-RMVPE](https://huggingface.co/AnhP/HPA-RMVPE)

---

# Бенчмарк алгоритмов детекции высоты тона

## Методология оценки

### Настройка эксперимента
Бенчмарк оценивает алгоритмы детекции высоты тона на множестве датасетов с различными характеристиками: синтетические и реальные аудиозаписи из области речи и музыки. Каждый алгоритм тестируется на зашумлённом аудио, полученном путём смешивания чистых записей с фоновым шумом CHiME при различных соотношениях сигнал/шум (10-30 дБ) и вариациях усиления голоса (-6...+6 дБ).

### Определение метрики производительности
Итоговый рейтинг показывает гармоническое среднее (HM) в процентах, вычисленное из шести компонентов:

**HM = 6 / (1/RPA + 1/CA + 1/P + 1/R + 1/OA + 1/GEA)**

| Метрика | Описание |
|---------|----------|
| **RPA** (Raw Pitch Accuracy) | Доля вокализованных фреймов в пределах 50 центов от эталона |
| **CA** (Cents Accuracy) | exp(-mean_cents_error/500) — экспоненциальный штраф за отклонения |
| **P** (Voicing Precision) | TP/(TP+FP) — точность определения вокализованных фреймов |
| **R** (Voicing Recall) | TP/(TP+FN) — полнота обнаружения вокализованных фреймов |
| **OA** (Octave Accuracy) | exp(-10×octave_error_rate) — устойчивость к октавным ошибкам |
| **GEA** (Gross Error Accuracy) | exp(-5×gross_error_rate) — штраф за отклонения >200 центов |

### Параметры измерения скорости
Замеры времени CPU выполнены на 1-секундных аудиосигналах с частотой дискретизации 22.05 кГц и шагом окна 256 сэмплов.

### Анализ оптимального порога
**Оптимальный порог** — порог уверенности вокализации, максимизирующий гармоническое среднее. Тестируются пороги от 0.0 до 1.0 с шагом 0.1. **CV** — коэффициент вариации (std/mean), измеряющий стабильность по датасетам.

---

## Описание датасетов

| Датасет | Домен | Тип | Описание |
|---------|-------|-----|----------|
| **NSynth** | Музыка | Синтетический | Одиночные ноты синтезированных музыкальных инструментов |
| **PTDB** | Речь | Реальный | Речевые записи с ларингографическими сигналами голосовых связок |
| **PTDBNoisy** | Речь | Реальный | Подмножество PTDB (7.4% файлов) с заметным шумом |
| **MIR1K** | Музыка | Реальный | Вокальные фрагменты с алгоритмически извлечёнными питч-контурами (YIN) + ручная коррекция |
| **MDBStemSynth** | Музыка | Синтетический | Музыкально структурированное синтетическое аудио |
| **Vocadito** | Музыка | Реальный | Сольные вокальные записи с аннотациями pYIN + ручная верификация |
| **Bach10Synth** | Музыка | Синтетический | Синтезированные исполнения Баха с точными метками высоты тона |
| **SpeechSynth** | Речь | Синтетический | Синтетическая мандаринская речь (LightSpeech TTS, 97.48 часов AISHELL-3 + Biaobei) |

**Ключевые характеристики:**
- **Синтетические** — идеальная разметка, но меньше реалистичности
- **Реальные** — естественные вариации, но неидеальные аннотации
- **Речевые** — задачи трекинга высоты голоса
- **Музыкальные** — инструментальные и вокальные сценарии

---

## Итоговый рейтинг производительности

| Алгоритм | Bach10Synth ↑ | MDBStemSynth ↑ | MIR1K ↑ | PTDB ↑ | PTDBNoisy ↑ | SpeechSynth ↑ | Vocadito ↑ | Среднее ↑ |
|----------|:-------------:|:--------------:|:-------:|:------:|:-----------:|:-------------:|:----------:|:---------:|
| RMVPE | 98.3% | 91.7% | **`96.0%`** | 86.0% | 66.6% | **`90.5%`** | **`97.2%`** | 89.5% |
| HPA_RMVPE_76000 | **`99.0%`** | **`94.0%`** | 95.9% | **`92.5%`** | **`84.3%`** | 87.6% | 97.0% | **`92.9%`** |

---

## Детальный анализ производительности

### Детекция вокализации
Оценка способности алгоритмов различать вокализованные и невокализованные сегменты.

| Алгоритм | Precision ↑ | Recall ↑ | F1-Score ↑ |
|----------|:-----------:|:--------:|:----------:|
| RMVPE | 0.891 | 0.816 | 0.851 |
| HPA_RMVPE_76000 | **`0.926`** | **`0.866`** | **`0.893`** |

### Метрики точности высоты тона

| Алгоритм | RPA ↑ | RCA ↑ | Cents Error ↓ | RMSE (Hz) ↓ | Octave Error ↓ | Gross Error ↓ |
|----------|:-----:|:-----:|:-------------:|:-----------:|:--------------:|:-------------:|
| RMVPE | 0.901 | 0.905 | 32.2 | 13.3 | 0.011 | 0.014 |
| HPA_RMVPE_76000 | **`0.915`** | **`0.915`** | **`21.7`** | **`9.3`** | **`0.003`** | **`0.007`** |

**Дополнительные определения:**
- **RCA** — доля с правильным классом ноты (без учёта октавы)
- **Cents Error** — средняя абсолютная ошибка в центах
- **RMSE** — среднеквадратичная ошибка в Гц

### Плавность питч-контура
Измеряет временну́ю стабильность и непрерывность питч-треков.

| Алгоритм | Relative Smoothness ↓ | Continuity Breaks ↓ | Overall Rank ↓ |
|----------|:---------------------:|:-------------------:|:--------------:|
| RMVPE | **`1.327`** | **`0.866`** | **`1.0`** |
| HPA_RMVPE_76000 | 1.569 | 0.903 | 2.0 |

**Определения:**
- **Relative Smoothness** — коэффициент вариации последовательных изменений питча
- **Continuity Breaks** — доля эталонных вокализованных сегментов с разрывами в предсказании
- **Overall Rank** — средний ранг (1 = лучший)

### Анализ оптимального порога

| Алгоритм | Средний порог | Std Dev ↓ | Диапазон |
|----------|:-------------:|:---------:|:--------:|
| RMVPE | 0.686 | **`0.064`** | 0.60-0.80 |
| HPA_RMVPE_76000 | 0.443 | 0.090 | 0.30-0.60 |

### Стабильность алгоритмов
Коэффициент вариации (CV = std/mean) — стабильность по датасетам.

| Алгоритм | Performance CV ↓ | Threshold CV ↓ |
|----------|:----------------:|:--------------:|
| RMVPE | 0.113 | **`0.093`** |
| HPA_RMVPE_76000 | **`0.052`** | 0.204 |

---

## Производительность по подмножествам

### По происхождению данных

| Алгоритм | Синтетические ↑ | Реальные ↑ |
|----------|:---------------:|:----------:|
| RMVPE | **`93.5%`** | 86.4% |
| HPA_RMVPE_76000 | **`93.5%`** | **`92.4%`** |

> **Синтетические:** Bach10Synth, MDBStemSynth, SpeechSynth, NSynth  
> **Реальные:** MIR1K, PTDB, PTDBNoisy, Vocadito

### По домену

| Алгоритм | Речь ↑ | Музыка ↑ |
|----------|:------:|:--------:|
| RMVPE | 81.0% | 95.8% |
| HPA_RMVPE_76000 | **`88.1%`** | **`96.5%`** |

> **Речь:** PTDB, PTDBNoisy, SpeechSynth  
> **Музыка:** Bach10Synth, MDBStemSynth, NSynth, Vocadito, MIR1K

### По комбинации признаков

| Алгоритм | Синт. + Речь ↑ | Синт. + Музыка ↑ | Реал. + Речь ↑ | Реал. + Музыка ↑ |
|----------|:--------------:|:----------------:|:--------------:|:----------------:|
| RMVPE | **`90.5%`** | 95.0% | 76.3% | **`96.6%`** |
| HPA_RMVPE_76000 | 87.6% | **`96.5%`** | **`88.4%`** | 96.5% |

---

## Ключевые выводы

| Критерий | Лучший алгоритм |
|----------|-----------------|
| Общая точность | HPA_RMVPE_76000 (92.9%) |
| Стабильность по датасетам | HPA_RMVPE_76000 (CV = 0.052) |
| Плавность контура | RMVPE (ранг 1.0) |
| Синтетическая речь | RMVPE (90.5%) |
| Реальная речь | HPA_RMVPE_76000 (88.4%) |
